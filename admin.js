async function fetchOrders(){const{data:e,error:n,count:t}=await supabase.from("user_orders").select("date, order_items, full_name, email_order, order_id",{count:"exact"}).range((currentPage-1)*itemsPerPage,currentPage*itemsPerPage-1).order("date",{ascending:!1});return n?(console.error("Error fetching orders:",n),[]):(totalOrders=t,e)}async function updateTable(){const e=await fetchOrders(),n=(currentPage-1)*itemsPerPage,t=getCurrentLanguage();tableBody.innerHTML=e.map((e,r)=>{const o=Array.isArray(e.order_items)?e.order_items:[e.order_items],a=o.map(e=>`<a href="#" class="clickable-link" onclick="openDesignDetails('${e.design_name}')">\n                ${e.design_name}\n            </a>`).join("<br>"),s=new Date(e.date),i=new Intl.DateTimeFormat(t,{year:"numeric",month:"short",day:"numeric"}).format(s),d=new Intl.DateTimeFormat(t,{hour:"2-digit",minute:"2-digit"}).format(s);return`\n            <tr>\n                <td>${n+r+1}</td>\n                <td>\n                    ${i}<br>\n                    <span class="order-time">${d}</span>\n                </td>\n                <td>${a}</td>\n                <td>${e.full_name}</td>\n                <td>${e.email_order}</td>\n                <td>\n                    <a href="#" class="clickable-link" onclick="showOrderDetails('${e.order_id}')">\n                        ${e.order_id}\n                    </a>\n                </td>\n            </tr>\n        `}).join("");const r=Math.ceil(totalOrders/itemsPerPage);updatePaginationInfo(n+1,Math.min(n+e.length,totalOrders),totalOrders),prevPageBtn.disabled=1===currentPage,nextPageBtn.disabled=currentPage===r,updatePageNumbers(r)}function updatePaginationInfo(e,n,t){const r=document.getElementById("pagination-info");if(!r)return;const o=getCurrentLanguage(),a={en:`Showing ${e} to ${n} of ${t} results`,fr:`Affichage de ${e} à ${n} sur ${t} résultats`};r.textContent=a[o]}function updatePageNumbers(e){let n=[];n=e<=3?Array.from({length:e},(e,n)=>n+1):currentPage<=2?[1,2,3]:currentPage>=e-1?[e-2,e-1,e]:[currentPage-1,currentPage,currentPage+1],pageNumbers.innerHTML=n.map(e=>`\n        <button class="page-number ${e===currentPage?"active":""}"\n                onclick="goToPage(${e})">${e}</button>\n    `).join("")}function goToPage(e){currentPage=e,updateTable()}async function showOrderDetails(e){const{data:n,error:t}=await supabase.from("user_orders").select("*").eq("order_id",e).single();if(t)return void console.error("Error fetching order details:",t);const r=Array.isArray(n.order_items)?n.order_items:[n.order_items];let o=`\n        <div class="modal-content">\n            <span class="close">&times;</span>\n            <h2>Order Details</h2>\n            <p><strong>Order ID:</strong> ${n.order_id}</p>\n            <p><strong>Date:</strong> ${new Date(n.date).toLocaleString()}</p>\n            <p><strong>Full Name:</strong> ${n.full_name}</p>\n            <p><strong>Email:</strong> ${n.email_order}</p>\n            <h3>Order Items:</h3>\n    `;r.forEach(e=>{o+=`\n            <div class="order-item">\n                <p><strong>Design Name:</strong> ${e.design_name}</p>\n                <p><strong>Silicon Grip:</strong> ${e.silicon_grip?"Yes":"No"}</p>\n                <p><strong>Total Quantity:</strong> ${e.item_total_quantity}</p>\n                <p><strong>Sizes:</strong></p>\n                <ul>\n                    ${Object.entries(e.sizes).map(([e,n])=>`\n                        <li>${e}: ${n}</li>\n                    `).join("")}\n                </ul>\n            </div>\n        `}),o+="</div>";const a=document.getElementById("order-details-modal");a.innerHTML=o,a.style.display="block";const s=a.querySelector(".close");s.onclick=function(){a.style.display="none"}}function showOrderDetails(e){const n=`order-details.html?orderId=${encodeURIComponent(e)}`;window.open(n,"_blank")}async function findShortCodeByName(e){const{data:n,error:t}=await supabase.from("user_files").select("short_code").or(`design_name.eq."${e}",custom_name.eq."${e}"`).single();return t?(console.error("Error finding shortcode:",t),null):n?n.short_code:null}async function openDesignDetails(e){const n=await findShortCodeByName(e);n?window.open(`admin-design.html?shortCode=${encodeURIComponent(n)}`,"_blank"):(console.error("Shortcode not found for design:",e),window.translatedAlert("design_details_not_found"))}let currentPage=1;const itemsPerPage=20;let totalOrders=0;const tableBody=document.getElementById("orders-table-body"),prevPageBtn=document.getElementById("prev-page"),nextPageBtn=document.getElementById("next-page"),pageNumbers=document.querySelector(".page-numbers"),paginationInfo=document.querySelector(".pagination-info");prevPageBtn.addEventListener("click",()=>{currentPage>1&&(currentPage--,updateTable())}),nextPageBtn.addEventListener("click",()=>{currentPage<Math.ceil(totalOrders/itemsPerPage)&&(currentPage++,updateTable())}),window.onclick=function(e){const n=document.getElementById("order-details-modal");e.target==n&&(n.style.display="none")},updateTable(),window.openDesignDetails=openDesignDetails,window.showOrderDetails=showOrderDetails,window.goToPage=goToPage;