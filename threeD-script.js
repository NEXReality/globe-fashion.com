function switchVariant(e,t){scene.traverse(e=>{e instanceof THREE.Mesh&&e.material.name.includes("breathable")&&(e.material.normalMap=t,e.material.normalMap.wrapS=THREE.RepeatWrapping,e.material.normalMap.wrapT=THREE.RepeatWrapping,e.material.normalMap.repeat.set(10,10),e.material.normalMap.needsUpdate=!0)})}function sRGBToLinearRGB(e){function t(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.3)}const a=e.match(/\d+/g);if(!a||a.length<3)return null;let[r,o,n]=a.map(Number).map(e=>e/255);return r=t(r),o=t(o),n=t(n),`rgb(${Math.round(255*r)}, ${Math.round(255*o)}, ${Math.round(255*n)})`}function threeColorToFabric(e){if(e.isColor){const t=Math.round(255*e.r),a=Math.round(255*e.g),r=Math.round(255*e.b);return`rgb(${t}, ${a}, ${r})`}throw new Error("Invalid color input")}function getLinearColorSpace(e){const t=e.match(/\d+/g);if(!t||t.length<3)return null;let[a,r,o]=t.map(Number).map(e=>e/255);const n=new THREE.Color(a,r,o),i=n.convertSRGBToLinear();return threeColorToFabric(i)}function getLighterColor(e,t=20){const a=e.match(/\d+/g);if(!a)return e;let[r,o,n]=a.map(Number);const i=e=>Math.min(255,Math.round(e+t/100*(255-e)));return r=i(r),o=i(o),n=i(n),`rgb(${r}, ${o}, ${n})`}function createImageObject(e,t,a,r,o=0){e.set({left:t,top:a,scaleX:r,scaleY:r,angle:o,cornerSize:10,transparentCorners:!1,cornerColor:"blue",borderColor:"blue",cornerStyle:"circle",centeredScaling:!0,padding:5,name:"imageLayer",flipY:!0}),e.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,mtr:!1}),e.controls.deleteControl=new fabric.Control({x:.5,y:0,offsetY:0,offsetX:16,cursorStyle:"pointer",mouseUpHandler:deleteObject,render:renderIcon(deleteImg),cornerSize:24}),e.controls.cloneControl=new fabric.Control({x:-.5,y:0,offsetY:0,offsetX:-16,cursorStyle:"pointer",mouseUpHandler:cloneObject,render:renderIcon(cloneImg),cornerSize:24}),legFabricCanvas.add(e),e.bringToFront()}function deleteObject(e,t){const a=t.target.canvas;a.remove(t.target),a.requestRenderAll()}function cloneObject(e,t){const a=t.target.canvas;t.target.clone().then(e=>{e.left+=10,e.top+=10,e.controls.deleteControl=t.target.controls.deleteControl,e.controls.cloneControl=t.target.controls.cloneControl,a.add(e)})}function renderIcon(e){return function(t,a,r,o,n){const i=this.cornerSize;t.save(),t.translate(a,r),t.rotate(fabric.util.degreesToRadians(n.angle)),t.drawImage(e,-i/2,-i/2,i,i),t.restore()}}function reconstructImages(e,t){t.forEach(e=>{fabric.Image.fromURL(e.data,function(t){createImageObject(t,e.left,e.top,e.scale,e.angle)},{crossOrigin:"anonymous"})}),e.renderAll()}function generateStripedTextureForLeg(e){legFabricCanvas.setBackgroundColor(lastLegColor,legFabricCanvas.renderAll.bind(legFabricCanvas));let t=legStripesGapWidth[e],a=legStripesAngle[e],r=legNumberOfStripes[e],o=legStripeHeight[e],n=legStripesOffsetTop[e];"tab1"==e?getStripes(legStripesOrientation,r,o,t,lastLegStripeColorTab1,n,a,"legStripesLayer1"):"tab2"==e?getStripes(legStripesOrientation,r,o,t,lastLegStripeColorTab2,n,a,"legStripesLayer2"):"tab3"==e&&getStripes(legStripesOrientation,r,o,t,lastLegStripeColorTab3,n,a,"legStripesLayer3"),"tab4"==e&&getStripes(legStripesOrientation,r,o,t,lastLegStripeColorTab4,n,a,"legStripesLayer4"),legCanvasTexture.colorSpace=THREE.SRGBColorSpace,legCanvasTexture.needsUpdate=!0,applyImageToLeg()}function generateStripedTextureForCuff(e){cuffFabricCanvas.setBackgroundColor(lastCuffColor,cuffFabricCanvas.renderAll.bind(cuffFabricCanvas));let t=cuffStripesGapWidth[e],a=cuffStripesAngle[e],r=cuffNumberOfStripes[e],o=cuffStripeHeight[e],n=cuffStripesOffsetTop[e];"tab1"==e?getStripes(cuffStripesOrientation,r,o,t,lastCuffStripeColorTab1,n,a,"cuffStripesLayer1"):"tab2"==e?getStripes(cuffStripesOrientation,r,o,t,lastCuffStripeColorTab2,n,a,"cuffStripesLayer2"):"tab3"==e&&getStripes(cuffStripesOrientation,r,o,t,lastCuffStripeColorTab3,n,a,"cuffStripesLayer3"),"tab4"==e&&getStripes(cuffStripesOrientation,r,o,t,lastCuffStripeColorTab4,n,a,"cuffStripesLayer4"),cuffCanvasTexture.colorSpace=THREE.SRGBColorSpace,cuffCanvasTexture.needsUpdate=!0}function setCameraPositionWithAnimation(e){let t=cameraPositions[e];camera.position.set(t.x,t.y,t.z),camera.zoom=t.zoom,camera.lookAt(t.lookAtx,t.lookAty,t.lookAtz)}import*as THREE from"three";import{OrbitControls}from"three/addons/controls/OrbitControls.js";import{GLTFLoader}from"three/addons/loaders/GLTFLoader.js";let cameraPositions={initial:{x:1.58,y:1.04,z:-6.67,zoom:1,lookAtx:0,lookAty:4,lookAtz:0},foot:{x:1.11,y:-2.03,z:-4.6,zoom:2,lookAtx:0,lookAty:0,lookAtz:0},leg:{x:.8,y:2,z:-3.5,zoom:1,lookAtx:0,lookAty:4,lookAtz:0},cuff:{x:.8,y:4,z:-3.56,zoom:1.5,lookAtx:0,lookAty:0,lookAtz:0}},lastSockMaterial=null,lastLegColor="rgb(234, 238, 241)",lastFootColor=null,lastCuffColor="rgb(234, 238, 241)",lastSoleColor=null,lastElasticRibFootColor=null,lastElasticRibLegColor=null,lastLegStripeColorTab1=null,lastLegStripeColorTab2=null,lastLegStripeColorTab3=null,lastLegStripeColorTab4=null,lastCuffStripeColorTab1=null,lastCuffStripeColorTab2=null,lastCuffStripeColorTab3=null,lastCuffStripeColorTab4=null;const viewerContainer=document.querySelector(".viewer-container"),threeContainer=viewerContainer,gui=new lil.GUI,debugObject={foot_color:16777215,leg_color:16777215,cuff_color:16777215,envMapIntensity:1};gui.hide();const canvas=document.querySelector("canvas.webgl"),scene=new THREE.Scene,textureLoader=new THREE.TextureLoader,footBreathableNormalMap=textureLoader.load("textures/breathable_nm.jpg"),footKnittedNormalMap=textureLoader.load("textures/knitted_nm.jpg");footBreathableNormalMap.flipY=!0,footKnittedNormalMap.flipY=!0;const soleRibDifferentNormalMap=textureLoader.load("textures/sole_rib_diff_nm.png"),soleRibSameNormalMap=textureLoader.load("textures/sole_rib_same_nm.jpg");soleRibDifferentNormalMap.flipY=!0,soleRibSameNormalMap.flipY=!0;const lightsContainer=new THREE.Object3D;scene.add(lightsContainer);const ambientLight=new THREE.AmbientLight(16777215,1.5);lightsContainer.add(ambientLight);const keyLight=new THREE.DirectionalLight(16777215,1);keyLight.position.set(-2,2,2),lightsContainer.add(keyLight);const fillLight=new THREE.DirectionalLight(16777215,.5);fillLight.position.set(2,-1,-1),lightsContainer.add(fillLight);const backLight=new THREE.DirectionalLight(16777215,.5);let environmentMap;backLight.position.set(1,3,-2),lightsContainer.add(backLight),lightsContainer.rotation.y=Math.PI;let nylonMaterialRoughness=.45,cottonMaterialRoughness=.75,loadedGLTF=null;const updateAllInitial3DSettingsForSock=e=>{const t=e.foot.soleMaterial,a=e.sock.material;updateSockMaterial(a);const r=e.foot.color.colorRGB,o=e.foot.elasticRibColor.colorRGB,n=e.foot.soleColor.colorRGB,i=e.foot.construction,s=e.foot.siliconeTapeGrip;updateSoleMaterial(t),updateFootColor(r),updateElasticRibFootColor(o),updateSoleColor(n),updateFootBreathableNormalMap(i),toggleSiliconGrip(s);const l=e.leg.color.colorRGB,c=e.leg.elasticRibColor.colorRGB;legStripesOrientation=e.leg.stripes.orientation,lastLegStripeColorTab1=e.leg.stripes.tab1.color.colorRGB,legNumberOfStripes.tab1=e.leg.stripes.tab1.count,legStripesAngle.tab1=e.leg.stripes.tab1.rotation,legStripesGapWidth.tab1=10*e.leg.stripes.tab1.gap,legStripeHeight.tab1=10*e.leg.stripes.tab1.thickness,legStripesOffsetTop.tab1=10*e.leg.stripes.tab1.position,lastLegStripeColorTab2=e.leg.stripes.tab2.color.colorRGB,legNumberOfStripes.tab2=e.leg.stripes.tab2.count,legStripesAngle.tab2=e.leg.stripes.tab2.rotation,legStripesGapWidth.tab2=10*e.leg.stripes.tab2.gap,legStripeHeight.tab2=10*e.leg.stripes.tab2.thickness,legStripesOffsetTop.tab2=10*e.leg.stripes.tab2.position,lastLegStripeColorTab3=e.leg.stripes.tab3.color.colorRGB,legNumberOfStripes.tab3=e.leg.stripes.tab3.count,legStripesAngle.tab3=e.leg.stripes.tab3.rotation,legStripesGapWidth.tab3=10*e.leg.stripes.tab3.gap,legStripeHeight.tab3=10*e.leg.stripes.tab3.thickness,legStripesOffsetTop.tab3=10*e.leg.stripes.tab3.position,lastLegStripeColorTab4=e.leg.stripes.tab4.color.colorRGB,legNumberOfStripes.tab4=e.leg.stripes.tab4.count,legStripesAngle.tab4=e.leg.stripes.tab4.rotation,legStripesGapWidth.tab4=10*e.leg.stripes.tab4.gap,legStripeHeight.tab4=10*e.leg.stripes.tab4.thickness,legStripesOffsetTop.tab4=10*e.leg.stripes.tab4.position,updateLegColor(l),updateElasticRibLegColor(c),updateStripesOrientationUI(legStripesOrientation,"orientation1"),legNumberOfStripes.tab1>0&&generateStripedTextureForLeg("tab1"),legNumberOfStripes.tab2>0&&generateStripedTextureForLeg("tab2"),legNumberOfStripes.tab3>0&&generateStripedTextureForLeg("tab3"),legNumberOfStripes.tab4>0&&generateStripedTextureForLeg("tab4");const p=e.leg.logo;reconstructImages(legFabricCanvas,p);const g=e.cuff.color.colorRGB,u=e.cuff.height;cuffStripesOrientation=e.leg.stripes.orientation,lastCuffStripeColorTab1=e.cuff.stripes.tab1.color.colorRGB,cuffNumberOfStripes.tab1=e.cuff.stripes.tab1.count,cuffStripesAngle.tab1=e.cuff.stripes.tab1.rotation,cuffStripesGapWidth.tab1=10*e.cuff.stripes.tab1.gap,cuffStripeHeight.tab1=10*e.cuff.stripes.tab1.thickness,cuffStripesOffsetTop.tab1=10*e.cuff.stripes.tab1.position,lastCuffStripeColorTab2=e.cuff.stripes.tab2.color.colorRGB,cuffNumberOfStripes.tab2=e.cuff.stripes.tab2.count,cuffStripesAngle.tab2=e.cuff.stripes.tab2.rotation,cuffStripesGapWidth.tab2=10*e.cuff.stripes.tab2.gap,cuffStripeHeight.tab2=10*e.cuff.stripes.tab2.thickness,cuffStripesOffsetTop.tab2=10*e.cuff.stripes.tab2.position,lastCuffStripeColorTab3=e.cuff.stripes.tab3.color.colorRGB,cuffNumberOfStripes.tab3=e.cuff.stripes.tab3.count,cuffStripesAngle.tab3=e.cuff.stripes.tab3.rotation,cuffStripesGapWidth.tab3=10*e.cuff.stripes.tab3.gap,cuffStripeHeight.tab3=10*e.cuff.stripes.tab3.thickness,cuffStripesOffsetTop.tab3=10*e.cuff.stripes.tab3.position,lastCuffStripeColorTab4=e.cuff.stripes.tab4.color.colorRGB,cuffNumberOfStripes.tab4=e.cuff.stripes.tab4.count,cuffStripesAngle.tab4=e.cuff.stripes.tab4.rotation,cuffStripesGapWidth.tab4=10*e.cuff.stripes.tab4.gap,cuffStripeHeight.tab4=10*e.cuff.stripes.tab4.thickness,cuffStripesOffsetTop.tab4=10*e.cuff.stripes.tab4.position,updateCuffColor(g),manageOpacityMapOfCuff(u),updateStripesOrientationUI(cuffStripesOrientation,"orientation2"),cuffNumberOfStripes.tab1>0&&generateStripedTextureForCuff("tab1"),cuffNumberOfStripes.tab2>0&&generateStripedTextureForCuff("tab2"),cuffNumberOfStripes.tab3>0&&generateStripedTextureForCuff("tab3"),cuffNumberOfStripes.tab4>0&&generateStripedTextureForCuff("tab4")};export function loadInitialConfig(e){const t=new GLTFLoader;t.load("./models/Sock_05_Jan29.glb",t=>{t.scene.scale.set(5,5,5),t.scene.position.set(.5,-1.5,0),t.scene.rotation.y=1.5*Math.PI/2,scene.add(t.scene),e?updateAllInitial3DSettingsForSock(e):(manageOpacityMapOfCuff(0),updateLegColor(lastLegColor),updateCuffColor(lastCuffColor),updateSoleRibMaterial(soleRibSameNormalMap)),loadedGLTF=t})}const sockMaterialDropdown=document.getElementById("sock-material-select");sockMaterialDropdown.addEventListener("change",e=>{const t=e.target.value;updateSockMaterial(t),soleMaterialDropdown.value=t});const updateSockMaterial=e=>{lastSockMaterial=e,"nylon"===e?updateRoughnessofAllMaterials(nylonMaterialRoughness):"cotton"===e&&updateRoughnessofAllMaterials(cottonMaterialRoughness),updateSoleRibMaterial(soleRibSameNormalMap)},updateRoughnessofAllMaterials=e=>{scene.traverse(t=>{t instanceof THREE.Mesh&&t.material instanceof THREE.MeshStandardMaterial&&(t.material.envMap=environmentMap,t.material.envMapIntensity=debugObject.envMapIntensity,t.material.roughness=e,t.castShadow=!0,t.receiveShadow=!0)})},updateSoleRibMaterial=e=>{scene.traverse(t=>{t instanceof THREE.Mesh&&t.material instanceof THREE.MeshStandardMaterial&&t.material.name.includes("sole_rib")&&(t.material.normalMap=e,t.material.normalMap.wrapS=THREE.RepeatWrapping,t.material.normalMap.wrapT=THREE.RepeatWrapping,t.material.normalMap.repeat.set(8,8),t.material.normalMap.needsUpdate=!0)})},soleMaterialDropdown=document.getElementById("sole-material-select");soleMaterialDropdown.addEventListener("change",e=>{const t=e.target.value;updateSoleMaterial(t)});const updateSoleMaterial=e=>{"nylon"===e?updateRoughnessofSoleMaterial(nylonMaterialRoughness):"cotton"===e&&updateRoughnessofSoleMaterial(cottonMaterialRoughness),updateSoleRibMaterial(e!==lastSockMaterial?soleRibDifferentNormalMap:soleRibSameNormalMap)},updateRoughnessofSoleMaterial=e=>{scene.traverse(t=>{t instanceof THREE.Mesh&&t.material instanceof THREE.MeshStandardMaterial&&(t.material.name.includes("sole")||t.material.name.includes("toe")||t.material.name.includes("angle above"))&&(t.material.envMap=environmentMap,t.material.envMapIntensity=debugObject.envMapIntensity,t.material.roughness=e,t.castShadow=!0,t.receiveShadow=!0)})},constructionDropdown=document.getElementById("construction-select");constructionDropdown.addEventListener("change",e=>{const t=e.target.value;updateFootBreathableNormalMap(t)});const updateFootBreathableNormalMap=e=>{"Regular knit"===e?switchVariant(loadedGLTF,footKnittedNormalMap):"Breathable mesh"===e&&switchVariant(loadedGLTF,footBreathableNormalMap)},updateFootColor=e=>{lastFootColor=e,scene.traverse(t=>{t instanceof THREE.Mesh&&(t.material.name.includes("breathable")||t.material.name.includes("foot")||t.material.name.includes("sole"))&&t.material.color.set(e)})},updateLegColor=e=>{lastLegColor=e;getLighterColor(e,50);legFabricCanvas.setBackgroundColor(e,legFabricCanvas.renderAll.bind(legFabricCanvas)),legCanvasTexture.needsUpdate=!0,applyImageToLeg(),updateElasticRibLegColor(lastElasticRibLegColor)},updateCuffColor=e=>{lastCuffColor=e;sRGBToLinearRGB(e);cuffFabricCanvas.setBackgroundColor(e,cuffFabricCanvas.renderAll.bind(cuffFabricCanvas)),cuffCanvasTexture.needsUpdate=!0,applyImageToCuff()},updateElasticRibFootColor=e=>{lastElasticRibFootColor=e,scene.traverse(t=>{t instanceof THREE.Mesh&&t.material.name.includes("rib_foot")&&t.material.color.set(e)})},updateElasticRibLegColor=e=>{lastElasticRibLegColor=e,scene.traverse(t=>{t instanceof THREE.Mesh&&t.material.name.includes("rib_leg")&&(t.material.color.set(e),t.material.blending=THREE.NormalBlending)})},updateSoleColor=e=>{lastSoleColor=e,scene.traverse(t=>{t instanceof THREE.Mesh&&(t.material.name.includes("sole")||t.material.name.includes("toe")||t.material.name.includes("angle above"))&&t.material.color.set(e)})};export function handleColorChange(e,t){"foot-color"==t?updateFootColor(e):"sole-color"==t?updateSoleColor(e):"leg-color"==t?updateLegColor(e):"cuff-color"==t?updateCuffColor(e):"elastic-rib-foot-color"==t?updateElasticRibFootColor(e):"elastic-rib-leg-color"==t?updateElasticRibLegColor(e):"leg-stripes-color-tab1"==t?(lastLegStripeColorTab1=e,generateStripedTextureForLeg("tab1")):"leg-stripes-color-tab2"==t?(lastLegStripeColorTab2=e,generateStripedTextureForLeg("tab2")):"leg-stripes-color-tab3"==t?(lastLegStripeColorTab3=e,generateStripedTextureForLeg("tab3")):"leg-stripes-color-tab4"==t?(lastLegStripeColorTab4=e,generateStripedTextureForLeg("tab4")):"cuff-stripes-color-tab1"==t?(lastCuffStripeColorTab1=e,generateStripedTextureForCuff("tab1")):"cuff-stripes-color-tab2"==t?(lastCuffStripeColorTab2=e,generateStripedTextureForCuff("tab2")):"cuff-stripes-color-tab3"==t?(lastCuffStripeColorTab3=e,generateStripedTextureForCuff("tab3")):"cuff-stripes-color-tab4"==t&&(lastCuffStripeColorTab4=e,generateStripedTextureForCuff("tab4")),console.log("Color ----->",e)}const siliconeTapeCheckbox=document.getElementById("silicone-tape-checkbox");siliconeTapeCheckbox.addEventListener("change",e=>{e.target.checked?toggleSiliconGrip(!0):toggleSiliconGrip(!1)});const toggleSiliconGrip=e=>{scene.traverse(t=>{t instanceof THREE.Mesh&&t.name.includes("silicon")&&(t.visible=e)})},container=viewerContainer,fabricContainer=document.createElement("div");fabricContainer.id="fabricContainer",fabricContainer.style.width="1px",fabricContainer.style.left="-100px",fabricContainer.style.height="50%",fabricContainer.style.borderRight="1px solid #ccc",fabricContainer.style.overflow="hidden",fabricContainer.style.position="relative",container.appendChild(fabricContainer);const legFabricCanvasElement=document.createElement("canvas");legFabricCanvasElement.width=1024,legFabricCanvasElement.height=1024,legFabricCanvasElement.style.width="100%",legFabricCanvasElement.style.height="100%",fabricContainer.appendChild(legFabricCanvasElement);const legFabricCanvas=new fabric.Canvas(legFabricCanvasElement);legFabricCanvas.setBackgroundColor("white",legFabricCanvas.renderAll.bind(legFabricCanvas)),legFabricCanvas.on("after:render",()=>{legCanvasTexture.needsUpdate=!0});const cuffFabricCanvasElement=document.createElement("canvas");cuffFabricCanvasElement.width=1024,cuffFabricCanvasElement.height=1024,cuffFabricCanvasElement.style.width="100%",cuffFabricCanvasElement.style.height="100%",fabricContainer.appendChild(cuffFabricCanvasElement);const cuffFabricCanvas=new fabric.Canvas(cuffFabricCanvasElement);cuffFabricCanvas.setBackgroundColor("white",cuffFabricCanvas.renderAll.bind(cuffFabricCanvas)),cuffFabricCanvas.on("after:render",()=>{cuffCanvasTexture.needsUpdate=!0});const legCanvasTexture=new THREE.CanvasTexture(legFabricCanvasElement),cuffCanvasTexture=new THREE.CanvasTexture(cuffFabricCanvasElement),deleteImg=document.createElement("img");deleteImg.src="./icons/delete.svg";const cloneImg=document.createElement("img");cloneImg.src="./icons/copy.svg";let imageLogo=null,legImageLogos=[];const applyImageToLeg=()=>{legCanvasTexture.needsUpdate=!0,scene.traverse(e=>{if(e instanceof THREE.Mesh&&e.material.name.includes("leg")){const t=e.material;t.normalMap,t.map;e.material.map=legCanvasTexture,e.material.color.set("rgb(255, 255, 255)"),e.material.map.colorSpace=THREE.SRGBColorSpace,e.material.needsUpdate=!0;const a=legFabricCanvas.getObjects();for(let e of a)"imageLayer"==e.name&&e.bringToFront()}})};export function readLogo(e){fabric.Image.fromURL(e,e=>{createImageObject(e,50,legFabricCanvas.height/2-e.height/2,1),imageLogo=e},{crossOrigin:"anonymous"}),applyImageToLeg(),legFabricCanvas.renderAll()}let legLogoScaleInput=document.getElementById("logo-scale"),legLogoRotateInput=document.getElementById("logo-rotate");legLogoScaleInput.addEventListener("input",e=>{const t=parseFloat(e.target.value);scaleLogo(t)}),legLogoRotateInput.addEventListener("input",e=>{const t=parseFloat(e.target.value);rotateLogo(t)});export function rotateLogo(e){const t=legFabricCanvas.getActiveObject();t&&"image"===t.type&&(t.rotate(e),legFabricCanvas.renderAll())}export function scaleLogo(e){const t=legFabricCanvas.getActiveObject();t&&"image"===t.type&&(t.centeredScaling=!0,t.scaleX=e,t.scaleY=e,t.setCoords(),legFabricCanvas.renderAll())}export function getLogosInfo(){legImageLogos=[];const e=legFabricCanvas.getObjects();for(let t of e)if("imageLayer"==t.name){const e={scale:t.scaleX,top:t.top,left:t.left,angle:t.angle,data:t._element.currentSrc};legImageLogos.push(e)}return console.log("legImageLogos -> ",legImageLogos),legImageLogos}let legStripesGapWidth={tab1:100,tab2:100,tab3:100,tab4:100},legStripesAngle={tab1:0,tab2:0,tab3:0,tab4:0},legStripesOffsetTop={tab1:0,tab2:0,tab3:0,tab4:0},legStripeHeight={tab1:50,tab2:50,tab3:50,tab4:50},legNumberOfStripes={tab1:1,tab2:0,tab3:0,tab4:0},legStripesOrientation="horizontal";const legStripesOrientationSelect=document.getElementById("leg-stripes-orientation");legStripesOrientationSelect.addEventListener("change",e=>{if("radio"===e.target.type){const t=e.target.value;legStripesOrientation=t,console.log(`Selected orientation: ${t}`),updateStripesOrientationUI(t,"orientation1"),generateStripedTextureForLeg("tab1"),generateStripedTextureForLeg("tab2"),generateStripedTextureForLeg("tab3"),generateStripedTextureForLeg("tab4")}});const updateStripesOrientationUI=(e,t)=>{document.querySelectorAll(".radio-options").forEach(a=>{const r=a.querySelector(".radio-background"),o=a.querySelectorAll(`input[type="radio"][name="${t}"]`);o.forEach(e=>{e.removeEventListener("change",e.orientationChangeHandler)}),o.forEach(e=>{e.orientationChangeHandler=(()=>{"vertical"===e.value?r.style.transform="translateX(100%)":r.style.transform="translateX(0)"}),e.addEventListener("change",e.orientationChangeHandler)}),r.style.transform="vertical"===e?"translateX(100%)":"translateX(0)"})};let legStripeDropdownTab1=document.getElementById("leg-stripes-select-tab1");legStripeDropdownTab1.addEventListener("change",e=>{const t=e.target.value;legNumberOfStripes.tab1="1"===t?1:"2"===t?2:"3"===t?3:"4"===t?4:0,generateStripedTextureForLeg("tab1")});let legStripesPositionFromTopInputTab1=document.getElementById("leg-stripes-position-top-tab1"),legStripesRotationInputTab1=document.getElementById("leg-stripes-rotation-tab1"),legStripesGapInputTab1=document.getElementById("leg-stripes-gap-tab1"),legStripesThicknessInputTab1=document.getElementById("leg-stripes-thickness-tab1");legStripesPositionFromTopInputTab1.addEventListener("input",e=>{legStripesOffsetTop.tab1=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab1")}),legStripesRotationInputTab1.addEventListener("input",e=>{legStripesAngle.tab1=parseFloat(e.target.value),generateStripedTextureForLeg("tab1")}),legStripesGapInputTab1.addEventListener("input",e=>{legStripesGapWidth.tab1=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab1")}),legStripesThicknessInputTab1.addEventListener("input",e=>{legStripeHeight.tab1=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab1")});let legStripeDropdownTab2=document.getElementById("leg-stripes-select-tab2");legStripeDropdownTab2.addEventListener("change",e=>{const t=e.target.value;legNumberOfStripes.tab2="1"===t?1:"2"===t?2:"3"===t?3:"4"===t?4:0,generateStripedTextureForLeg("tab2")});let legStripesPositionFromTopInputTab2=document.getElementById("leg-stripes-position-top-tab2"),legStripesRotationInputTab2=document.getElementById("leg-stripes-rotation-tab2"),legStripesGapInputTab2=document.getElementById("leg-stripes-gap-tab2"),legStripesThicknessInputTab2=document.getElementById("leg-stripes-thickness-tab2");legStripesPositionFromTopInputTab2.addEventListener("input",e=>{legStripesOffsetTop.tab2=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab2")}),legStripesRotationInputTab2.addEventListener("input",e=>{legStripesAngle.tab2=parseFloat(e.target.value),generateStripedTextureForLeg("tab2")}),legStripesGapInputTab2.addEventListener("input",e=>{legStripesGapWidth.tab2=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab2")}),legStripesThicknessInputTab2.addEventListener("input",e=>{legStripeHeight.tab2=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab2")});let legStripeDropdownTab3=document.getElementById("leg-stripes-select-tab3");legStripeDropdownTab3.addEventListener("change",e=>{const t=e.target.value;legNumberOfStripes.tab3="1"===t?1:"2"===t?2:"3"===t?3:"4"===t?4:0,generateStripedTextureForLeg("tab3")});let legStripesPositionFromTopInputTab3=document.getElementById("leg-stripes-position-top-tab3"),legStripesRotationInputTab3=document.getElementById("leg-stripes-rotation-tab3"),legStripesGapInputTab3=document.getElementById("leg-stripes-gap-tab3"),legStripesThicknessInputTab3=document.getElementById("leg-stripes-thickness-tab3");legStripesPositionFromTopInputTab3.addEventListener("input",e=>{legStripesOffsetTop.tab3=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab3")}),legStripesRotationInputTab3.addEventListener("input",e=>{legStripesAngle.tab3=parseFloat(e.target.value),generateStripedTextureForLeg("tab3")}),legStripesGapInputTab3.addEventListener("input",e=>{legStripesGapWidth.tab3=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab3")}),legStripesThicknessInputTab3.addEventListener("input",e=>{legStripeHeight.tab3=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab3")});let legStripeDropdownTab4=document.getElementById("leg-stripes-select-tab4");legStripeDropdownTab4.addEventListener("change",e=>{const t=e.target.value;legNumberOfStripes.tab4="1"===t?1:"2"===t?2:"3"===t?3:"4"===t?4:0,generateStripedTextureForLeg("tab4")});let legStripesPositionFromTopInputTab4=document.getElementById("leg-stripes-position-top-tab4"),legStripesRotationInputTab4=document.getElementById("leg-stripes-rotation-tab4"),legStripesGapInputTab4=document.getElementById("leg-stripes-gap-tab4"),legStripesThicknessInputTab4=document.getElementById("leg-stripes-thickness-tab4");legStripesPositionFromTopInputTab4.addEventListener("input",e=>{legStripesOffsetTop.tab4=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab4")}),legStripesRotationInputTab4.addEventListener("input",e=>{legStripesAngle.tab4=parseFloat(e.target.value),generateStripedTextureForLeg("tab4")}),legStripesGapInputTab4.addEventListener("input",e=>{legStripesGapWidth.tab4=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab4")}),legStripesThicknessInputTab4.addEventListener("input",e=>{legStripeHeight.tab4=10*parseFloat(e.target.value),generateStripedTextureForLeg("tab4")});const getStripes=(e,t,a,r,o,n,i,s)=>{const l=s.includes("leg"),c=legFabricCanvas.width,p=legFabricCanvas.height;clearLayer(s);const g=i*Math.PI/180,u=r+a,f=u/Math.cos(g),d=l?335:167,b=l?legFabricCanvas:cuffFabricCanvas;if("horizontal"==e)for(let e=0;e<t;e++){const t=new fabric.Rect({left:c/4,top:p-(d+e*f+n),width:4*c,height:a,fill:o,backgroundColor:"transparent",selectable:!1,angle:i,originX:"center",originY:"center",name:s});b.add(t)}else{let e=0==t?0:Math.ceil((600+r)/(a+r));for(let t=0;t<e;t++){const e=new fabric.Rect({left:n+t*(a+r)+6,top:p-d,width:a,height:2*p,fill:o,backgroundColor:"transparent",selectable:!1,angle:0,originX:"center",originY:"center",name:s});b.add(e)}}b.renderAll()},clearLayer=e=>{if(e.includes("leg")){const t=legFabricCanvas.getObjects().filter(t=>t.name===e);t.forEach(e=>legFabricCanvas.remove(e)),legFabricCanvas.renderAll()}else if(e.includes("cuff")){const t=cuffFabricCanvas.getObjects().filter(t=>t.name===e);t.forEach(e=>cuffFabricCanvas.remove(e)),cuffFabricCanvas.renderAll()}};let cuffStripesGapWidth={tab1:40,tab2:40,tab3:40,tab4:40},cuffStripesAngle={tab1:0,tab2:0,tab3:0,tab4:0},cuffStripesOffsetTop={tab1:70,tab2:70,tab3:70,tab4:70},cuffStripeHeight={tab1:20,tab2:20,tab3:20,tab4:20},cuffNumberOfStripes={tab1:1,tab2:0,tab3:0,tab4:0},cuffStripesOrientation="horizontal";const cuffStripesOrientationSelect=document.getElementById("cuff-stripes-orientation");cuffStripesOrientationSelect.addEventListener("change",e=>{if("radio"===e.target.type){const t=e.target.value;cuffStripesOrientation=t,updateStripesOrientationUI(t,"orientation2"),generateStripedTextureForCuff("tab1"),generateStripedTextureForCuff("tab2"),generateStripedTextureForCuff("tab3"),generateStripedTextureForCuff("tab4")}});let cuffStripeDropdownTab1=document.getElementById("cuff-stripes-select-tab1");cuffStripeDropdownTab1.addEventListener("change",e=>{const t=e.target.value;cuffNumberOfStripes.tab1="1"===t?1:"2"===t?2:"3"===t?3:"4"===t?4:0,generateStripedTextureForCuff("tab1")});let cuffStripesPositionFromTopInputTab1=document.getElementById("cuff-stripes-position-top-tab1"),cuffStripesRotationInputTab1=document.getElementById("cuff-stripes-rotation-tab1"),cuffStripesGapInputTab1=document.getElementById("cuff-stripes-gap-tab1"),cuffStripesThicknessInputTab1=document.getElementById("cuff-stripes-thickness-tab1");cuffStripesPositionFromTopInputTab1.addEventListener("input",e=>{cuffStripesOffsetTop.tab1=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab1")}),cuffStripesRotationInputTab1.addEventListener("input",e=>{cuffStripesAngle.tab1=parseFloat(e.target.value),generateStripedTextureForCuff("tab1")}),cuffStripesGapInputTab1.addEventListener("input",e=>{cuffStripesGapWidth.tab1=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab1")}),cuffStripesThicknessInputTab1.addEventListener("input",e=>{cuffStripeHeight.tab1=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab1")});let cuffStripeDropdownTab2=document.getElementById("cuff-stripes-select-tab2");cuffStripeDropdownTab2.addEventListener("change",e=>{const t=e.target.value;cuffNumberOfStripes.tab2="1"===t?1:"2"===t?2:"3"===t?3:"4"===t?4:0,generateStripedTextureForCuff("tab2")});let cuffStripesPositionFromTopInputTab2=document.getElementById("cuff-stripes-position-top-tab2"),cuffStripesRotationInputTab2=document.getElementById("cuff-stripes-rotation-tab2"),cuffStripesGapInputTab2=document.getElementById("cuff-stripes-gap-tab2"),cuffStripesThicknessInputTab2=document.getElementById("cuff-stripes-thickness-tab2");cuffStripesPositionFromTopInputTab2.addEventListener("input",e=>{cuffStripesOffsetTop.tab2=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab2")}),cuffStripesRotationInputTab2.addEventListener("input",e=>{cuffStripesAngle.tab2=parseFloat(e.target.value),generateStripedTextureForCuff("tab2")}),cuffStripesGapInputTab2.addEventListener("input",e=>{cuffStripesGapWidth.tab2=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab2")}),cuffStripesThicknessInputTab2.addEventListener("input",e=>{cuffStripeHeight.tab2=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab2")});let cuffStripeDropdownTab3=document.getElementById("cuff-stripes-select-tab3");cuffStripeDropdownTab3.addEventListener("change",e=>{const t=e.target.value;cuffNumberOfStripes.tab3="1"===t?1:"2"===t?2:"3"===t?3:"4"===t?4:0,generateStripedTextureForCuff("tab3")});let cuffStripesPositionFromTopInputTab3=document.getElementById("cuff-stripes-position-top-tab3"),cuffStripesRotationInputTab3=document.getElementById("cuff-stripes-rotation-tab3"),cuffStripesGapInputTab3=document.getElementById("cuff-stripes-gap-tab3"),cuffStripesThicknessInputTab3=document.getElementById("cuff-stripes-thickness-tab3");cuffStripesPositionFromTopInputTab3.addEventListener("input",e=>{cuffStripesOffsetTop.tab3=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab3")}),cuffStripesRotationInputTab3.addEventListener("input",e=>{cuffStripesAngle.tab3=parseFloat(e.target.value),generateStripedTextureForCuff("tab3")}),cuffStripesGapInputTab3.addEventListener("input",e=>{cuffStripesGapWidth.tab3=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab3")}),cuffStripesThicknessInputTab3.addEventListener("input",e=>{cuffStripeHeight.tab3=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab3")});let cuffStripeDropdownTab4=document.getElementById("cuff-stripes-select-tab4");cuffStripeDropdownTab4.addEventListener("change",e=>{const t=e.target.value;cuffNumberOfStripes.tab4="1"===t?1:"2"===t?2:"3"===t?3:"4"===t?4:0,generateStripedTextureForCuff("tab4")});let cuffStripesPositionFromTopInputTab4=document.getElementById("cuff-stripes-position-top-tab4"),cuffStripesRotationInputTab4=document.getElementById("cuff-stripes-rotation-tab4"),cuffStripesGapInputTab4=document.getElementById("cuff-stripes-gap-tab4"),cuffStripesThicknessInputTab4=document.getElementById("cuff-stripes-thickness-tab4");cuffStripesPositionFromTopInputTab4.addEventListener("input",e=>{cuffStripesOffsetTop.tab4=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab4")}),cuffStripesRotationInputTab4.addEventListener("input",e=>{cuffStripesAngle.tab4=parseFloat(e.target.value),generateStripedTextureForCuff("tab4")}),cuffStripesGapInputTab4.addEventListener("input",e=>{cuffStripesGapWidth.tab4=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab4")}),cuffStripesThicknessInputTab4.addEventListener("input",e=>{cuffStripeHeight.tab4=10*parseFloat(e.target.value),generateStripedTextureForCuff("tab4")});const applyImageToCuff=()=>{cuffCanvasTexture.needsUpdate=!0,scene.traverse(e=>{if(e instanceof THREE.Mesh&&e.material.name.includes("cuff")){const t=e.material;t.normalMap,t.map;e.material.map=cuffCanvasTexture,e.material.color.set("rgb(255, 255, 255)"),e.material.map.colorSpace=THREE.SRGBColorSpace,e.material.needsUpdate=!0}})};let cuffHeightDropdown=document.getElementById("cuff-height-select")
;const normal=new THREE.Vector3(0,-1,0),euler=new THREE.Euler(2*Math.PI/180,0,0);normal.applyEuler(euler);const initialPosOfClippingPlane=1.7,clippingPlane=new THREE.Plane(normal,initialPosOfClippingPlane);cuffHeightDropdown.addEventListener("change",e=>{const t=e.target.value;manageOpacityMapOfCuff(parseInt(t))});const manageOpacityMapOfCuff=e=>{clippingPlane.constant=initialPosOfClippingPlane-.03*(6-e),scene.traverse(e=>{e instanceof THREE.Mesh&&e.material.name.includes("cuff")&&(e.material.clippingPlanes=[clippingPlane],e.material.needsUpdate=!0)})},raycaster=new THREE.Raycaster,mouse=new THREE.Vector2;let isDragging=!1,selectedImage=null,dragStartPosition={x:0,y:0},imageStartPosition={x:0,y:0};threeContainer.addEventListener("mousedown",e=>{raycaster.setFromCamera(mouse,camera);const t=raycaster.intersectObject(loadedGLTF.scene);if(t.length>0){isDragging=!0;const e=t[0].uv;dragStartPosition={x:e.x,y:e.y};const a={x:1024*e.x,y:1024*e.y};let r=legFabricCanvas.getActiveObject();if(null==r){const e=legFabricCanvas.getObjects();for(let t of e)if("imageLayer"==t.name&&t.containsPoint({x:a.x,y:1024-a.y})){legFabricCanvas.setActiveObject(t),r=t;break}legFabricCanvas.renderAll()}if(r){if(r.controls.deleteControl){const e=r.controls.deleteControl,t=r.controls.cloneControl,o=r.angle*Math.PI/180,n=r.getCenterPoint(),i=e.x*r.width*r.scaleX+e.offsetX,s=e.y*r.height*r.scaleY+e.offsetY,l=i*Math.cos(o)-s*Math.sin(o),c=i*Math.sin(o)+s*Math.cos(o),p=n.x+l,g=1024-(n.y+c),u=e.cornerSize;console.log("HitPoint: ",a),console.log("Delete Pos: ",p,g,u);const f=t.x*r.width*r.scaleX+t.offsetX,d=t.y*r.height*r.scaleY+t.offsetY,b=f*Math.cos(o)-d*Math.sin(o),m=f*Math.sin(o)+d*Math.cos(o),S=n.x+b,h=1024-(n.y+m);if(a.x>=p-u/2&&a.x<=p+u/2&&a.y>=g-u/2&&a.y<=g+u/2)return legFabricCanvas.remove(r),void legFabricCanvas.renderAll();if(a.x>=S-u/2&&a.x<=S+u/2&&a.y>=h-u/2&&a.y<=h+u/2)return void r.clone(function(e){createImageObject(e,e.left+40,e.top+40,e.scaleX,e.angle),legFabricCanvas.setActiveObject(e),legFabricCanvas.renderAll()})}selectedImage=r,imageStartPosition={x:selectedImage.left,y:selectedImage.top},isDragging=!0,controls.enabled=!1}}else legFabricCanvas.discardActiveObject(),legFabricCanvas.requestRenderAll()}),threeContainer.addEventListener("mousemove",e=>{const t=threeContainer.getBoundingClientRect();if(mouse.x=(e.clientX-t.left)/t.width*2-1,mouse.y=-(e.clientY-t.top)/t.height*2+1,isDragging&&selectedImage){raycaster.setFromCamera(mouse,camera);const e=raycaster.intersectObject(loadedGLTF.scene);if(e.length>0){const t=e[0].uv,a=t.x-dragStartPosition.x,r=-(t.y-dragStartPosition.y);selectedImage.set({left:imageStartPosition.x+a*legFabricCanvas.width,top:imageStartPosition.y+r*legFabricCanvas.height}),legFabricCanvas.renderAll(),controls.enabled=!1}}}),threeContainer.addEventListener("mouseup",()=>{isDragging&&(isDragging=!1,selectedImage=null,controls.enabled=!0)}),threeContainer.addEventListener("mouseleave",()=>{isDragging&&(isDragging=!1,selectedImage=null,controls.enabled=!0)});const sizes={width:threeContainer.clientWidth,height:threeContainer.clientHeight};window.addEventListener("resize",()=>{});const camera=new THREE.PerspectiveCamera(40,sizes.width/sizes.height,.1,100);setCameraPositionWithAnimation("initial"),camera.lookAt(0,4,0),scene.add(camera);const controls=new OrbitControls(camera,threeContainer);controls.enableDamping=!0;let sockPartSelect=document.getElementById("sock-part-select");const partButtons=sockPartSelect.querySelectorAll(".part-button");partButtons.forEach(e=>{e.addEventListener("click",()=>{const t=e.querySelector("span[data-en]").textContent;console.log("Selected Part:",t)})});const renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:!0});renderer.setSize(sizes.width,sizes.height),renderer.domElement.style.width=sizes.width,renderer.domElement.style.height=sizes.height,threeContainer.appendChild(renderer.domElement),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),renderer.useLegacyLights=!0,renderer.localClippingEnabled=!0,renderer.outputColorSpace=THREE.SRGBColorSpace,renderer.toneMapping=THREE.AgXToneMapping,renderer.toneMappingExposure=.3,renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap;const tick=()=>{controls.update(),renderer.render(scene,camera),window.requestAnimationFrame(tick)};tick();export async function takeScreenshot(){const e=camera.position.clone(),t=camera.zoom,a=camera.quaternion.clone(),r=camera.aspect,o=renderer.domElement.width,n=renderer.domElement.height,i={x:1.58,y:1.04,z:-6.67,zoom:1,lookAtx:0,lookAty:0,lookAtz:0};camera.position.set(i.x,i.y,i.z),camera.zoom=i.zoom,camera.lookAt(i.lookAtx,i.lookAty,i.lookAtz),camera.aspect=3200/1800,camera.updateProjectionMatrix();const s=document.createElement("canvas");return s.width=3200,s.height=1800,renderer.setSize(3200,1800),renderer.render(scene,camera),s.getContext("2d").drawImage(renderer.domElement,0,0,3200,1800),camera.position.copy(e),camera.zoom=t,camera.quaternion.copy(a),camera.aspect=r,camera.updateProjectionMatrix(),renderer.setSize(o,n),renderer.render(scene,camera),new Promise(e=>{s.toBlob(e,"image/webp",.8)})}export function takeCurrentViewScreenshot(){const e=window.innerWidth,t=window.innerHeight,a=e/t;let r,o;a>16/9?(r=3200,o=Math.round(3200/a)):(o=1800,r=Math.round(1800*a));const n=renderer.domElement.width,i=renderer.domElement.height,s=document.createElement("canvas");s.width=r,s.height=o,renderer.setSize(r,o);const l=camera.aspect;camera.aspect=a,camera.updateProjectionMatrix(),renderer.render(scene,camera),s.getContext("2d").drawImage(renderer.domElement,0,0,r,o),renderer.setSize(n,i),camera.aspect=l,camera.updateProjectionMatrix(),renderer.render(scene,camera),s.toBlob(e=>{const t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="current_view_screenshot.png",t.click(),URL.revokeObjectURL(t.href)},"image/png")}